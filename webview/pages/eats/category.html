<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>Bootstrap 101 Template</title>
    <!-- <link rel="stylesheet" href="./styles/base.css"> -->
    <link href="https://cdn.bootcdn.net/ajax/libs/fullPage.js/2.9.7/jquery.fullpage.css" rel="stylesheet">
    <!-- Bootstrap -->
     
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.2/css/swiper.css">
    <!-- <link rel="stylesheet" href="./iconfont/iconfont.css"> -->
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_2242864_w7vbld6no4h.css">
    <link rel="stylesheet" href="/webview/commonPage/header.css">
    <link rel="stylesheet" href="/webview/commonPage/footer.css">
    <link rel="stylesheet" href="/webview/plugin/8-jiandanshiyong/src/jquery.page.css">
    <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.js"></script>
    <script type="text/javascript" src="/webview/plugin/8-jiandanshiyong/src/jquery.page.js"></script>
    <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
      
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.0.2/js/swiper.js"></script>
    <script src="/webview/plugin/template/template.js"></script> 
    <style>
      @media only screen and (min-width:750px) {
      	body {
      		/* height: 300%; */
      		background: white;
      		color: #ff9d02;
      	}
      	.search {
      		margin-top: 66px;
      		margin-bottom: 40px;
      	}
      	.search input {
      		border: 4px solid #ff9d02;
      		width: 655px;
      		height: 60px;
      		outline: none;
      	}
      	.search input:focus {
      		border: 4px solid #ff9d02;
      	}
      	.search button {
      		border: none;
      		width: 200px;
      		height: 60px;
      		outline: none;
      		background: #ff9d02;
      		cursor: pointer;
      		vertical-align: top;
      		font-family: Source Han Sans SC;
      		font-weight: 500;
      		font-size: 20px;
      		color: #fff;
      	}
      	.header-image {
      		width: 100%;
      		height: 400px;
      	}
      	.header-image img {
      		width: 100%;
      		height: 400px;
      	}
      	.first,
      	.last {
      		width: 45px;
      	}

      	.content {
      		margin-top: 60px;
      		margin-bottom: 75px;
      		padding: 0 144px;
      		min-height: 800px;
      	}

      	.content .left-category {
      		margin-right: 9px;
      		cursor: pointer;
      	}

      	.content .right-detail {
      		width: 100%;
      		height: 100%;
      	}

      	.content .right-detail .image-item {
      		width: 254px;
      		height: 254px;
      	}

      	.content .right-detail .image-item img {
      		width: 254px;
      		height: 254px;
      	}
      	.content .right-detail #page-item .text {
      		margin-top: 24px;
      		margin-bottom: 17px;
      		padding: 0 32px;
      		text-align: center;
      		color: #333;
      	}

      	.content .right-detail .item {
      		margin: 0 5px 22px 5px;
      		padding: 29px 33px;
      		border: 1px solid #bbb;
      		width: 320px;
      		height: 410px;
      		background: rgba(104, 105, 104, 0);
      		cursor: pointer;
      	}

      	/*手风琴*/
      	.left-category ul {
      		list-style-type: none;
      	}

      	.left-category .parentWrap {
      		width: 274px;
      		text-align: center;
      	}

      	.left-category .menuGroup {
      		border-bottom: 1px solid #fff;
      		background-color: #ff9d02;
      		color: #fff;
      	}

      	.left-category .groupTitle {
      		display: block;
      		/* border-bottom: 1px solid #ccc; */
      		width: 274px;
      		height: 84px;
      		cursor: pointer;
      		line-height: 84px;
      		font-size: 18px;
      	}

      	.left-category .menuGroup > div {
      		display: none;
      		background-color: #fff;
      	}
      	.left-category .menuGroup > div > ul > li {
      		height: 66px;
      		background-color: #686968;
      		line-height: 66px;
      		color: white;
      	}
      	/*手风琴*/
      	.rules-tips,
      	.page-min-content {
      		display: none;
      	}
      }
      @media only screen and (max-width:750px) {
      	.content {
      		margin-bottom: 200px;
      	}
      	.search {
      		padding: 12px 8px;
      	}
      	.category {
      		/* height: 100%; */
      	}
      	.search input {
      		border: 4px solid #ff9d02;
      		width: 288px;
      		height: 40px;
      		outline: none;
      	}
      	.search input:focus {
      		border: 4px solid #ff9d02;
      	}
      	.search button {
      		border: none;
      		width: 66px;
      		height: 40px;
      		outline: none;
      		background: #ff9d02;
      		cursor: pointer;
      		vertical-align: top;
      		font-family: Source Han Sans SC;
      		font-weight: 500;
      		font-size: 18px;
      		color: #fff;
      	}
      	.header-image,
      	#page,
      	.left-category,
      	.right-detail {
      		display: none;
      	}
      	body {
      		background: white;
      		color: #ff9d02;
      	}
      	.rules-tips {
      		position: relative;
      		padding: 24px 22.5px 12px 22.5px;
      		width: 100%;
      	}
      	.rules-content {
      		display: flex;
      		justify-content: space-between;
      		margin-bottom: 20px;
      		width: 100%;
      		min-height: 50px;
      	}
      	.rules-content .item {
      		display: flex;
      		flex-direction: column;
      		justify-content: center;
      		align-items: center;
      		margin-bottom: 20px;
      		border-radius: 50%;
      		width: 50px;
      		height: 50px;
      		background-color: #ff8500;
      		text-align: center;
      	}
      	.rules-text-content {
      		display: flex;
      		justify-content: space-between;
      	}
      	.rules-text-content .item {
      		padding: 32px;
      		width: 20%;
      		height: 240px;
      		background: #f2f2f2;
      		background-color: #ff8500;
      	}
      	.page-min-content {
      		overflow-y: scroll;
      		/* margin-bottom: 170px; */
      		height: 100%;
      	}
      	.page-min-content #page-min .item {
      		margin: 0 5px 22px 5px;
      		padding: 10px 17px;
      		border: 1px solid #bbb;
      		/* width: 47%; */
      		height: 225px;
      		background: rgba(104, 105, 104, 0);
      	}
      	.page-min-content #page-min .image-item {
      		margin: auto;
      		width: 140px;
      		height: 140px;
      	}

      	.page-min-content #page-min .image-item img {
      		width: 100%;
      		height: 100%;
      	}


      	.page-min-content #page-min .item .text {
      		margin-top: 12px;
      		margin-bottom: 4px;
      		padding: 0 8px;
      		text-align: center;
      		font-size: 12px;
      		color: #333;
      	}
      	/*手风琴*/
      	.left-category span {
      		display: none;
      	}
      	.left-category > ul {
      		list-style-type: none;
      		margin-left: 8px;
      		margin-right: 17px;
      		font-size: 12px;
      	}

      	.left-category .parentWrap {
      		width: 74px;
      		text-align: center;
      	}

      	.left-category .menuGroup {
      		border-bottom: 1px solid #fff;
      		background-color: #ff9d02;
      		color: #fff;
      	}

      	.left-category .groupTitle {
      		display: block;
      		/* border-bottom: 1px solid #ccc; */
      		width: 75px;
      		height: 40px;
      		cursor: pointer;
      		line-height: 40px;
      		font-size: 12px;
      	}

      	.left-category .menuGroup > div {
      		display: none;
      		background-color: #fff;
      	}
      	.left-category .menuGroup > div > ul > li {
      		height: 30px;
      		background-color: #686968;
      		line-height: 30px;
      		color: white;
      	}
      	/*手风琴*/
      }
    </style>
  </head>
  <body>
     <div class="header color-main">

    </div>
    
    <div class="category pages">
      <div class="search flex flex-row flex-center">
        <div>
          <input type="text"><button>搜  索</button>
          <div id="page2222"></div>
        </div>
      </div>
      <div class="header-image">
        <img src="/webview/images/eats/header.png" alt="">
      </div>
      <div class="rules-tips">
        <div class="rules-content">
            <div class="item">
                <div class="flex flex-column" style="font-size: 14px;width: 75%;">
                    <i class="icon iconfont" style="font-size: 32px;color: white;">&#xe613;</i>
                </div>
                <div style="position: absolute;bottom: 24px;color: #333333;font-weight: 400;">
                  新品
                </div>
            </div>
            <div class="item">
                <div class="flex flex-column" style="font-size: 14px;width: 75%;">
                    <i class="icon iconfont" style="font-size: 32px;color: white;">&#xe614;</i>
                </div>
                <div style="position: absolute;bottom: 24px;color: #333333;font-weight: 400;">
                  类别
                </div>
            </div>
            <div class="item">
                <div class="flex flex-column" style="font-size: 14px; color: white;width: 75%;">
                  <i class="icon iconfont" style="font-size: 32px;color: white;">&#xe63f;</i>
                </div>
                <div style="position: absolute;bottom: 24px;color: #333333;font-weight: 400;">
                  地域
                </div>
            </div>
            <div class="item categorys">
                <div class="flex flex-column" style="font-size: 14px; color: white;width: 75%;">
                    <i class="icon iconfont" style="font-size: 32px;color: white;">&#xe6ad;</i>
                </div>
                <div style="position: absolute;bottom: 24px;color: #333333;font-weight: 400;">
                  分类
                </div>
            </div>
        </div>
      </div>
      <div class="content flex">
        <div class="left-category">
          <ul class="parentWrap">
            <!-- <li class="menuGroup">
                <span class="groupTitle"><span class="icon iconfont" style="font-size: 20px;">&#xe613;</span>新品NEW</span>
                <div>
                  <ul>
                    <li>标题1-1</li>
                    <li>标题1-2</li>
                    <li>标题1-3</li>
                    <li>标题1-4</li>
                    <li>标题1-5</li>
                  </ul>
                </div>
            </li> -->
        </ul>
        </div>
        
        <div class="right-detail">
          <div class="" id="page-item">
            
          </div>
          <!-- <div class="flex flex-row flex-wrap pageItem" id="page2"> -->
            <!-- <div class="item" style="align-items: center;">
              <div class="image-item">
                <img src="/webview/images/eats/category_1.png" alt="">
              </div>
              <div style="padding: 0 32px;color: #333333;text-align: center;margin-top: 24px;margin-bottom: 17px;">
                一品粮味开心果新米 2021新小米五谷杂粮
              </div>
              <div style="text-align: center;">
                ¥20
              </div>
            </div> -->
          <!-- </div> -->
          <div id="page"></div>
        </div>
        <div class="page-min-content">
          <div id="page-min">
          </div>
        </div>
      </div>
      
      
    </div>
    <div class="footer">

    </div>
    
    <script>
      $(document).ready(function(){
        //jquery load方法加载公共头部
        $(".header").load("../../commonPage/header.html");
        $(".footer").load("../../commonPage/footer.html",function(){//加载完成后设置高亮
        // $('#page-item>#page-temp>div').show()
        let promise = new Promise(function() {}, function() {});
        console.log(promise)
        let curId = null;
        getImage(1,1)
        $.ajax({
          type: "GET",
          url: "https://api.1pinliangwei.com/category/admin/pageCategory.do",
          data: {pageNum:1,pageSize:10,status:true},
          dataType: "json",
          success: function(data){
            let list = data.data
            $('.left-category .parentWrap').html(template("category",list));
            $('.menuGroup .groupTitle').click(function () {
              if ($(this).data("flag")) {
                $(this).next().slideToggle();
                $(this).parent().siblings().find('div').slideUp();
              } else {
                getImage(1,$(this).data("id"), 'image')
              }
              
            })
            $('.menuGroup li').click(function () {
              console.log($(this).data("id"))
              $('.page-min-content .item').css({
                "width":"45%",
                "height":"164px",
                "padding": "4px 17px"
              })
              $('.page-min-content .image-item').css({
                "width":"90px",
                "height":"110px",
              })
              $('.page-min-content #page-min .item .text').css({
                "padding":"0",
                "margin": "0"
              })
              getImage(1,$(this).data("id"), 'image')
            })
          }
        })

        function getImage(page, id, key) {
          $.ajax({
                type: "GET",
                url: "https://api.1pinliangwei.com/product/selectProductByCategoryId.do",
                data: {pageNum:page,pageSize:8,categoryId:id},
                dataType: "json",
                success: function(res){
                  let lists = {};
                  lists['items'] = []
                  if (res.data.items && res.data.items.length > 0) {
                    lists['items'] = res.data.items.map(item=>{
                      return {
                        url: item.images[0].imageUrl,
                        discript: item.name,
                        price: item.price,
                        id: item.id
                      }
                    });
                    
                    if (key === 'key') {
                      $("#page").Page({
                        totalPages: res.data._meta.pageCount,//分页总数
                        liNums: res.data._meta.pageCount,//分页的数字按钮数(建议取奇数)
                        activeClass: 'activP', //active 类样式定义
                        callBack : function(page){
                          console.log(page)
                          getImage(page, id, 'key')
                        }
                      });
                    } 
                    $('#page-item').html(template("page-temp",lists));
                    $('#page-min').html(template("page-temp",lists));
                    console.log(key)
                    if (key === 'image') {
                      $('#page-min .item').css({
                        "width":"126px",
                        "height":"164px",
                        "padding": "4px 17px"
                      })
                      $('#page-min .image-item').css({
                        "width":"90px",
                        "height":"110px",
                      })
                      $('#page-min .item .text').css({
                        "padding":"0",
                        "margin": "0"
                      })
                    }
                  } else {
                    $('#page-item').html(template("page-temp",lists));
                    $('#page-min').html(template("page-temp",lists));
                  }
                  
                }
              })
        }
        
        $('.categorys.item').click(function() {
          console.log($(this))
          $('.rules-tips').hide()
          console.log(111)
          $('.left-category').show()
          $('.page-min-content .item').css({
            "width":"126px",
            "height":"164px",
            "padding": "4px 17px"
          })
          $('.page-min-content .image-item').css({
            "width":"90px",
            "height":"110px",
          })
          $('.page-min-content #page-min .item .text').css({
            "padding":"0",
            "margin": "0"
          })
          $('.page-min-content #page-min .item .price').hide()
        })

        $('#page-min').on('click','.item',function (e) {
          console.log(e)
          location.href ='./category_detail.html?id='+$(this).data("id");
        })
        $('#page-item').on('click','.item',function (e) {
          console.log(e)
          location.href ='./category_detail.html?id='+$(this).data("id");
        })
      });

    });
    </script>
    
  </body>
</html>
<script id="page-temp" type="text/html">
  
  <div id="pageList" class="flex flex-row flex-wrap">
    {{each items item index}}
      <div class="item" style="align-items: center;" data-id="{{item.id}}">
        <div class="image-item">
          <img src="https://api.1pinliangwei.com/product/selectImages/{{item.url}}" alt="">
        </div>
        <div class="text">
          {{item.discript}}
        </div>
        <div class="price" style="text-align: center;">
          ¥{{item.price}}
        </div>
      </div>
      {{/each}}
  </div>

</script>

<script id="category" type="text/html">
  {{each items item index}}
  <li class="menuGroup">
    <span class="groupTitle" data-id="{{item.id}}" data-flag="{{item.childCategory}}"><span class="icon iconfont" style="font-size: 20px;">&#xe6ad;</span>{{item.name}}</span>
    <div>
      {{each item.childCategory el i}}
      <ul>
        <li data-id="{{el.id}}">{{el.name}}</li>
      </ul>
      {{/each}}
    </div>
  </li>
  {{/each}}
</script>